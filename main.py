import os
import asyncio
from telegram import Update
from telegram.ext import (
    ApplicationBuilder, 
    CommandHandler, 
    MessageHandler, 
    ContextTypes, 
    filters
)

# -----------------------------
# ุชูุธูุงุช ุงููู
# -----------------------------
TOKEN = os.environ.get("TELEGRAM_TOKEN", "8249435097:AAGOIS7GfwBayCTSZGFahbMhYcZDFxzSGAg")
WEBHOOK_URL = f"https://mahzarbashi-telegram-bot-1-usa9.onrender.com/{TOKEN}"

# -----------------------------
# ุฏุณุชูุฑุงุช ุฑุจุงุช
# -----------------------------
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "๐ธ ุณูุงู! ูู ุฑุจุงุช ุญููู ูุญุถุฑุจุงุด ูุณุชู.\n"
        "ุงู ุฑุจุงุช ุชูุณุท *ูุณุชุฑู ุจูโุทุจุง* ุณุงุฎุชู ุดุฏู ู ูพุงุณุฎฺฏู ุณุคุงูุงุช ุญููู ุดูุงุณุช.\n"
        "ุณุคุงูุช ุฑู ุจููุณ ุชุง ุจุฑุฑุณ ฺฉูู โ๏ธ",
        parse_mode="Markdown"
    )

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = update.message.text.lower()

    if "ุทูุงู" in text:
        reply = (
            "ุฏุฑ ููุถูุน ุทูุงูุ ูุนูููุงู ุจุงุฏ ุฏุงุฏุฎูุงุณุช ุงุฒ ุทุฑู ุฏูุงุชุฑ ุฎุฏูุงุช ูุถุง ุซุจุช ุดูุฏ. "
            "ุฏุฑ ุตูุฑุช ฺฉู ุฒู ูุตุฏ ุทูุงู ุฏุงุดุชู ุจุงุดุฏุ ุจุงุฏ ฺฉ ุงุฒ ุดุฑูุท ุถูู ุนูุฏ ุง ุฏูุงู ููุฌู ุฑุง ุงุฑุงุฆู ุฏูุฏ. "
            "ุจุฑุง ุฌุฒุฆุงุช ุจุดุชุฑ ูโุชูู ุจู ุจุฎุด ูุดุงูุฑู ุณุงุช ูุญุถุฑุจุงุด ุณุฑ ุจุฒู ๐"
        )
    elif "ููุฑู" in text:
        reply = (
            "ููุฑู ุญู ูุงููู ุฒู ุงุณุช ู ูุฑ ุฒูุงู ุจุฎูุงูุฏ ูโุชูุงูุฏ ุขู ุฑุง ูุทุงูุจู ฺฉูุฏ. "
            "ุงฺฏุฑ ููุฑู ุนูุฏุงูุงุณุชุทุงุนู ุจุงุดุฏุ ูุฑุฏ ุจุงุฏ ุชูุงู ูุงู ุฎูุฏ ุฑุง ุซุงุจุช ฺฉูุฏ. "
            "ุฏุฑ ุบุฑ ุงู ุตูุฑุช ุฏุงุฏฺฏุงู ุฏุณุชูุฑ ุงุฌุฑุง ููุฑู ุฑุง ุตุงุฏุฑ ูโฺฉูุฏ โ๏ธ"
        )
    elif "ุงุฌุงุฑู" in text or "ูุณุชุฃุฌุฑ" in text:
        reply = (
            "ุฏุฑ ูุฑุงุฑุฏุงุฏ ุงุฌุงุฑูุ ูุณุชุฃุฌุฑ ููุธู ุงุณุช ููฺฉ ุฑุง ุฏุฑ ุฒูุงู ูุดุฎุต ุชุฎูู ฺฉูุฏ ู ููุฌุฑ ูู ุจุงุฏ ูุจูุบ ุฑูู ุฑุง ุจุงุฒฺฏุฑุฏุงูุฏ. "
            "ุจุฑุง ุงุฎุชูุงูุงุช ูุฑุจูุท ุจู ุชูุฏุฏ ุง ุชุฎููุ ุดูุฑุง ุญู ุงุฎุชูุงู ุตูุงุญุช ุฑุณุฏฺฏ ุฏุงุฑุฏ. "
            "ุฌุฒุฆุงุช ุจุดุชุฑ ุฏุฑ ุณุงุช ูุญุถุฑุจุงุด ููุฌูุฏ ุงุณุช ๐"
        )
    else:
        reply = (
            "ุณุคุงู ุดูุง ุจุฑุฑุณ ุดุฏ ุงูุง ูุงุฒ ุจู ุชูุถุญ ุจุดุชุฑ ุฏุงุฑุฏ. "
            "ูุทูุงู ููุถูุน ุฑุง ุฏููโุชุฑ ุจููุณ ุง ุงุฒ ุทุฑู ุณุงุช ูุญุถุฑุจุงุด ุจุฑุง ูุดุงูุฑู ุชุฎุตุต ุงูุฏุงู ฺฉู ๐"
        )

    await update.message.reply_text(reply)

# -----------------------------
# ุงุฌุฑุง ุฑุจุงุช
# -----------------------------
async def main():
    app = ApplicationBuilder().token(TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    await app.run_webhook(
        listen="0.0.0.0",
        port=int(os.environ.get("PORT", "10000")),
        url_path=TOKEN,
        webhook_url=WEBHOOK_URL
    )

if __name__ == "__main__":
    asyncio.run(main())
